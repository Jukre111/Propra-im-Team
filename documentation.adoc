# Abschlussprojekt

## Grundsätzliches

* Pair-programming.
* Morgens Gruppenmeeting.
* Retrospektiv-Meeting am Ende der Woche.
* Kein TDD, aber Test möglichst zeitnah schreiben.
* In jeden Commit schreiben, welche zwei Leute das gemacht haben(Vorname).
* Aufgaben die aktuell bearbeitet werden, bitte in der Datei aufgabenverteilung.adoc
schreiben (mit Namen)



## Codeformatierung & Richtlinien

* Commits im imperativ und auf Englisch.
* Code auf Englisch, CamelCase verwenden.
* Tabs werden verwendet.
* Checkstyle verwenden.
* FindBugs wird benutzt und Fehler zeitnah korrigiert.



## Aufgaben:
* Login
* Travis
* FindBugs
* Docker & Dockercompose
* Datenbank (Postgres)
* Benutzerkonto
* Suche (optional)
* Person anlegen
* Person bearbeiten
* Person löschen
* Artikel anlegen
* Artikel bearbeiten
* Artikel löschen
* Schnittstelle zu ProPay



## Model Datenstrukturen
* User bestehen aus:
. username : String (id)
** user haben eindeutige Usernamen, die in der Datenbank als Id verwendet werden.
. password : String
. role : String
** Es gibt die Rollen Admin und User.
*** Admins können die Konfliktlösestelle in ihrem Account aufrufen, für User wird der entsprechende
Button nicht dargestellt.
. lastname : String
. forename : String
. email : String
. birthdate : LocalDate
. address : Address
. borrowedItems :



 Die Items, die dem User gehoeren werden hier nicht gespeichert, stattdessen wird in jedem Item der Besitzer
vermerkt.

* Item
. id : Long
** ids werden von der Datenbank generiert.
. name : String
. description : String
. rental : int
. deposit : int
. Availability : List periods
** Hier werden alle Zeiträume gespeichert, in denen das Item verliehen ist.
. lender : User

* Request
. id : Long
** ids werden von Datenbank generiert.
. Zeitraum : period
. requester : User
** User der ausleihen möchte.

* BorrowedItems
. id : Long
. item : Item
** Item das ausgeliehen wird.
. request : Request
** request der akzeptiert wurde, sodass das Item jetzt ausgeliehen ist.
-> Das BorrowedItem repräsentiert den Ausleihprozess. Jeder User hat eine Liste ausgeliehener
BorrowedItems und verliehener BorrowedItems.




## Erläuterung der Datenstruktur
* User:
. Jeder Benutzer der Website wird als User Objekt gespeichert.
. Die User werden vom DatabaseInitializer mithilfe von Fakern autogeneriert.
. Die Regestrierung neuer usern ist nicht möglich.


* Address:
. Jede Adresse eines Benutzers wird als Objekt der Klasse Address im User gespeichert.
. Address ist embeddable, damit Benutzer mit derselben Adresse diese speichern können.

* Item:
. Jeder zur Vermietung eingestellte Artikel wird als Objekt der Klasse Item gespeichert.
. Die ID wird automatisch generiert, um die Artikel eindeutig voneinannder unterscheiden zu können.
. In jedem Item wird gespeichert, wem es gehört.

* Request:
. Ein Request wird generiert, wenn ein User ein Item eines anderen Users ausleihen möchte.




## Webstruktur

* Alle Html-Dateien benutzen das Layout der baseWithSearchBar.html, sodass grundlegende Funktionen,
wie Suche, Nachrichten, Account und Logout immer verfügbar sind.


* Index.html:
** Enthält Liste alles vorhandenen Items.
** Jedes Item hat einen Detail-Button, der zu der Seite Details.html führt, wobei die Id des
entsprechenden Items mitgegeben wird.

* Details.html
** Es wird eine Detailansicht des entsprechenden Items dargestellt.
** Darunter steht ein Ausleihbutton und ein Zurückbutton.
** Der Ausleihbutton linkt auf Request.html und gibt dieser die Id des entsprechenden Items
mit.
** Der Zurückbutton linkt auf Index.html.

* messages.html:
** Enthält zwei Tabellen:
** Die erste Tabelle enthält eine Liste aller Requests, die an den angemeldeten User gestellt
wurden (Zu Items, die mir gehören.)
** Diese Requests kann die angemeldete Person akzeptieren oder ablehnen.

* propayAccount.html:
** Zeigt den ProPay Account Namen eines Nutzers
** Zeigt das aktuelle Guthaben des Accounts
** Darunter befindet sich die Möglichkeit durch ein Feld und einen Button "Aufladen" sein Guthaben zu erhöhen
** Es werden zwei Tabellen (mit aus- und eingehenden Transaktionen) angezeigt

Bearbeiten:
** -> Wird akzeptiert
** -> Wird abgelehnt, so wird der Request gelöscht.

** Die zweite Tabelle enthält eine Liste aller Requests, die der angemeldete User gestellt hat.
** ->



## ProPay
* Account (Hilfsklasse)
** wird zum Empfangen von Json Daten verwendet
. account : String (speichert den Namen des Accounts)
. amount : int (speichert den Kontostand des Accounts)
. reservations : ArrayList<Reservation> (speichert alle aktuell vorhandenen Kautionen)
* Reservation (Hilfsklasse)
** wird zum Empfangen von Json Daten verwendet)
. id : int (speichert die Id der Kautionsreservierung)
. amount : int (speichert die Höhe der Kaution/des Deposits)
* Transaction (Model)
** wird verwendet um die Transaktionen auf der Website darzustellen
. reservationId : int (speichert die Id der dazugehörigen Kautionsreservierung)
. wholeRent : int (speichert die summierte Miete fuer alle Tage)
. deposit : int (speichert die Höhe der Kaution)
. processId : long (speichert die Id des dazu gehörigen Ausleihprozess)
. depositRevoked : boolean (ist standardmäßig auf false gesetzt, wird auf true geändert, wenn die Kaution eingezogen wurde)

### ProPayService
* Regelt die Kommunikation mit der ProPay Scs
* Gibt bei (fast) allen Methoden den HTML (Fehler-)Code zurrück um bei Aufruf individuell auf die Fehler reagieren zu können.
** bei einer Rückgabe von 200 kam es zu keinen Problemen
** bei -1 kam es zu internen Problemen, wie zum Beispiel Exceptions
** alle anderen Codes weisen auf fehlerhafte Kommunikation mit der ProPay Seite hin

### TransactionService
* Stellt eine Methode zum erstellen und durchführen einer Transaktion zur Verfügung
* Stellt eine Methode zur Verfügung, mit der sich prüfen lässt ob ein Guthaben für die komplette Miete und Kaution ausreicht.

### ProPayController
* Verwaltet die ProPay Account Website
** es gibt unter anderem die Möglichkeit sein Guthaben aufzuladen



## Architektur
GUI <-> Controller <-> Logik <-> Model <-> Datenbank <- DatabaseInitializer

